[supervisord]
nodaemon=true
logfile=/dev/null
logfile_maxbytes=0
loglevel=info
pidfile=/tmp/supervisord.pid
user=agentbox

[unix_http_server]
file=/tmp/supervisor.sock
chmod=0700

[rpcinterface:supervisor]
supervisor.rpcinterface_factory = supervisor.rpcinterface:make_main_rpcinterface

[supervisorctl]
serverurl=unix:///tmp/supervisor.sock

; ─────────────────────────────────────────────
; OpenClaw gateway (port 3000, internal only)
; Manages agent sessions, Slack, and channels
; ─────────────────────────────────────────────
[program:openclaw-gateway]
command=openclaw gateway run
environment=HOME="/agentbox",OPENCLAW_HOME="/agentbox/.openclaw"
autostart=true
autorestart=true
startretries=5
startsecs=5
stopwaitsecs=15
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
stderr_logfile=/dev/stderr
stderr_logfile_maxbytes=0
priority=5

; ─────────────────────────────────────────────
; One-shot Slack pairing (if SLACK_PAIRING_CODE is set)
; Waits for gateway, runs pairing, then exits
; ─────────────────────────────────────────────
[program:pair-slack]
command=/app/a2a/pair-slack.sh
environment=HOME="/agentbox",OPENCLAW_HOME="/agentbox/.openclaw"
autostart=true
autorestart=false
startsecs=0
exitcodes=0
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
stderr_logfile=/dev/stderr
stderr_logfile_maxbytes=0
priority=15

; ─────────────────────────────────────────────
; FastAPI A2A wrapper (port 8080)
; Proxies A2A JSON-RPC to openclaw gateway
; ─────────────────────────────────────────────
[program:uvicorn-a2a]
command=uvicorn a2a.server:app --host 0.0.0.0 --port 8080
directory=/app
environment=HOME="/agentbox",AGENTBOX_BACKEND="cli"
autostart=true
autorestart=true
startretries=5
startsecs=3
stopwaitsecs=10
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
stderr_logfile=/dev/stderr
stderr_logfile_maxbytes=0
priority=10
